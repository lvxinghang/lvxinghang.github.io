---
title: web安全总结
author: 阿航
date: 2020-10-1 14:10:00 +0800
pin: true
categories: [网络安全,Web]
tags: web安全

---



### XSS跨站脚本攻击

>本质上是一种`“HTML注入”`，用户的数据被当成了`HTML`代码的一部分来执行，从而混淆了原本的语义，产生了新的语义。
>
>1. 反射型XSS
>2. 存储型XSS
>3. 安全的编码函数
>
>* HtmlEncode
>
>将字符转换成HTMLEntities,对应的标准为ISO-8859-1。
>
>* JavascriptEncode
>
>与HtmlEncode编码方法不同，需要使用" \ "对特殊字符进行转义。在对抗XSS时，要求输出的变量必须                在引号内部。
>
>*****
>
>
>
>4. 防御XSS
>
>|      | HTML标签输出         | HTML属性输出              | <script>标签输出                  | 事件中输出                                   | CSS中输出                                                    | 地址中输出 |
>| ---- | -------------------- | ------------------------- | --------------------------------- | -------------------------------------------- | ------------------------------------------------------------ | ---------- |
>| 例   | `<div>$var</div>`    | `<div name="$var"></div>` | `<script> varx="$var"; </script>` | `<a href=# onclick="funcA('$var')">test</a>` | 略(P100)                                                     | ...        |
>| 防御 | 对变量使用HtmlEncode | 对变量使用HtmlEncode      | 使用JavascriptEncode              | 使用JavascriptEncode                         | 禁止用户可控制的变量再`<style>`标签,“HTML标签的style属性”以及“CSS文件”中输出 | ...        |
>
>地址中输出
>
>>```
>><a href = "$var" >test</a> 
>>```
>>
>>构造伪协议实施攻击:
>>
>>* ```
>>   <a href = "javascript:alert(1);" >test</a>
>>   ```
>> 
>>如果变量是整个URL,先检查变量是否以“http”开头，若不是则自动添加。
>
>5. 防御`DOM Based XSS`
>
>****



## 第4章 跨站点请求伪造(CSRF)

*****

### 4.1 CSRF简介

>1. 攻击者在自己的域中构造一个页面:
>
>   * ```
>     http://www.a.com/csrf.html
>     ```
>
>   * 内容为:
>
>   * ```
>     <img src ="http://blog.sohu.com/manage/entry.do?m=delete&id=156714243" />
>     ```
>
>   * 地址指向删除博客文章的链接，诱使目标用户访问该页面，图片标签会向服务器发送一次GET 请求，删除文章。
>

### 4.2 CSRF进阶

####        		1. 浏览器的cookie 策略

>  >*  Session Cookie（临时Cookie）
>  >* Third-party Cookie (本地Cookie)
>

#### 				2. P3P头

>  * 使`<iframe>,<script>`等标签在IE中不再拦截第三方Cookie的发送。
>

### 4.3 CSRF的防御

#### 						1. 验证码

#### 						2. Referer Check(防止图片盗链)

>>检查Referer是否合法来判断用户是否被CSRF攻击。
>>
>>缺陷:服务器并非什么时候都能取到Referer。

#### 						3. Anti CSRF Token

>  * 在URL尾部新增一个参数Token，要求生成足够随机，使用安全的随机数生成器。
>  * 为防止Token通过Referer的方式泄露，应该尽量将其放在表单中。把敏感操作GET改为POST，以form表单(或者ajax)的形式提交。
>
>*****



## 第5章 点击劫持(ClickJacking)

****

### 5.1 点击劫持(ClickJacking)

#### 		1. 概念

>  * 使用一个透明的，不可见的iframe覆盖在网页上，然后诱使用户在网页上操作，通过调整iframe页面的位置，使用户恰好点击在iframe页面的一些功能按钮上。

### 5.2 Flash点击劫持

### 5.3 图片覆盖攻击

>* XSIO(Cross Site Image Overlaying): 利用图片的style,或者能控制CSS。

### 5.4 拖拽劫持与数据劫持

>* 诱使用户从隐藏的不可见iframe中“拖拽”出攻击者希望得到的数据，然后放到攻击者能控制的另外一个页面中，从而窃取数据。

### 5.5 TapJacking(触屏劫持）

****



### 5.6 防御ClickJacking

  	#### 				1. frame busting

>>```
>>if (top.location != location) {
>>	top.location = self.location;
>>}
>>```
>>
>>通过上面代码禁止iframe的嵌套。
>>
>>缺陷：由于使用JavaScript写的，容易被绕过。
>>
>>解决该问题最好的方案是使用一个HTTP头。
>>
>>****
>
>****

#### 						2. X-Frame-Options

>>它有三个可选的值
>>
>>* DENY
>>* SAMEORIGIN
>>* ALLOW-FROM origin
>>
>>当值为DENY时，浏览器拒绝当前页面加载任何frame页面。
>>
>>若值为SAMEORIGIN，则frame页面的地址只能为同源域名下的页面。
>>
>>若值为ALLOW-FROM，则可以定义允许frame加载的页面地址。
>>
>>****
>
>****



## 第6章 HTML5 安全

*****

### 6.1 HTML5 新标签

#### 	     				1. iframe中的sandbox

>* `<iframe>`标签加载的内容被视为一个独立的源，其中的**脚本**被禁止执行，**表单**被禁止提交，**插件**被禁止加载，指向其它浏览对象的**链接**也会被禁止。
>
>* sandbox有以下几个属性
>
>* allow-same-origin: 允许同源访问
>* allow-top-navigation: 允许访问顶层窗口
>* allow-forms: 允许提交表单
>* allow-scripts: 允许执行脚本
>
>* iframe实例
>
>```
><iframe sandbox="allow-same-origin allow-forms allow-scripts"
>	src="http://......."</iframe>
>```

#### 		

#### 		2. Link Types: noreferre

>```
><a href="xxx" rel="noreferrer" >test</a>
>```
>
>标签指定了noreferrer后，浏览器在请求该标签的地址后不再发送Referer。

#### 						3. Canvas

****



### 6.2 其它安全

#### 						1. Cross-Origin Resource Sharing

>* Origin Header 用于标记HTTP发起的“源”，服务器端通过识别这个来判断浏览器的请求是否来自一个合法的“源”。

#### 						2. postMessage-跨窗口传递消息

>* postMessage允许每一个window对象往其他的窗口发送文本消息，从而实现跨窗口的消息传递。该功能不受同源策略限制。

#### 				3. Web Storage

>就像一个非关系型数据库，由Key-Value对组成，使用方法为:
>
>```
>设置一个值: window.sessionStorage.setItem(key,value);
>读取一个值: window.sessionStorage.getItem(key);
>```
>
>* Session Storage，关闭浏览器就会失效。
>* Local Storage，数据会一直存在。

****



## 第7章 注入攻击

### 7.1 SQL注入

​		注入攻击的的两个条件:

>* 用户能够控制数据的输入。
>* 原本要执行的代码拼接了用户的输入。

#### 						1. 盲注

>* 盲注验证：构造简单的条件语句，根据返回页面是否发生变化，来判断SQL语句是否得到执行。
>
>* ```
> http://newspaper.com/items.php?id=2 and 1=2
> ```
> ```
>* ```
> http://newspaper.com/items.php?id=2 and 1=1
> ```
>```
>对比上面两个页面返回结果的差异，判断是否存在SQL注入漏洞。
>```
>

#### 						2. Timing Attack

>* 利用BENCHMARK()
>

### 7.2 数据库攻击技巧

*****



### 7.3 防御SQL注入

#### 				1. 使用预编译语句

#### 				2. 使用存储过程

#### 				3. 检查数据类型

>* 限制用户输入数据的数据类型

#### 		4. 使用安全函数

### 		7.4 其它注入攻击

#### 				1. XML注入

#### 				2. 代码注入

#### 				3. CRLF注入

*****



## 第8章 文件上传漏洞

****

 





